<div class="csv-container">
    <label for="row-count-{{ include.file }}">Number of rows to display:</label>
    <input type="number" id="row-count-{{ include.file }}" value="{{ include.row | default: 5 }}" min="1" oninput="loadCSV('{{ include.file }}', this.value)">
</div>

<div class="csv-container">
    <table id="csv-table-{{ include.file }}" class="csv-table">
        <thead id="csv-header-{{ include.file }}"></thead>
        <tbody id="csv-body-{{ include.file }}"></tbody>
    </table>
</div>

<script src="{{site.baseurl}}/assets/script/papaparse.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        loadCSV('{{ include.file }}', {{ include.row | default: 5 }});
    });

    function loadCSV(file, rowCount) {
        Papa.parse('{{site.baseurl}}/assets/data/' + file, {
            download: true,
            header: true,
            complete: function(results) {
                displayCSV(results.data, rowCount, file);
            }
        });
    }

    function displayCSV(data, rowCount, file) {
        const header = document.getElementById('csv-header-' + file);
        const body = document.getElementById('csv-body-' + file);

        header.innerHTML = '';
        body.innerHTML = '';

        if (data.length === 0) return;

        const headerRow = document.createElement('tr');
        Object.keys(data[0]).forEach(key => {
            const th = document.createElement('th');
            th.textContent = key;
            headerRow.appendChild(th);
        });
        header.appendChild(headerRow);

        for (let i = 0; i < Math.min(rowCount, data.length); i++) {
            const row = document.createElement('tr');
            Object.values(data[i]).forEach(value => {
                const td = document.createElement('td');
                td.textContent = value;
                row.appendChild(td);
            });
            body.appendChild(row);
        }
    }
</script>
